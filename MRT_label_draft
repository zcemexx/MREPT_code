function [DataNoise] = gen_noise(vals, SNR, mask)
% gen_noise.m Generates noise of a certain SNR for complex data by 
% adding noise to the real and imaginary components seperately.
% Inputs:
%   vals:       Complex input field
%   SNR:        prefered SNR level
%   mask:       mask of input data
% Outputs:
%   DataNoise:  Noisy complex fields 
% COPYRIGHT: UMC Utrecht, Thierry Meerbothe, 12/05/2023 V.1.0

    % Set predifined seed. Seed set to "2023" will generate the same 
    % noise maps for everybody using ADEPT data.
    SEED = 2023;
    rng(SEED)

    % SNR magnitude
    SNR_Mag = SNR;

    %Duplicate the real and imaginary maps for different noise on the
    %amplitude and phase
    B1Real_Mag    = real(vals);
    B1Imag_Mag    = imag(vals);
    
    % Create the noise sets
    noiseReal_Mag   = randn(size(vals)).*abs(mean(vals(mask),'all'))/SNR_Mag;
    noiseImag_Mag   = randn(size(vals)).*abs(mean(vals(mask),'all'))/SNR_Mag;
    
    % Make the corrupted maps
    B1Real_Mag_Corrupted   = B1Real_Mag + noiseReal_Mag;
    B1Imag_Mag_Corrupted   = B1Imag_Mag + noiseImag_Mag;
    
    % Create the corrupted complex maps
    DataNoise   = B1Real_Mag_Corrupted + 1i*B1Imag_Mag_Corrupted;  
    
